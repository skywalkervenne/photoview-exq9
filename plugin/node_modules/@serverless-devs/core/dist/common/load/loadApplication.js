"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var service_1 = require("./service");
var constant_1 = require("../constant");
var path_1 = __importDefault(require("path"));
var downloadRequest_1 = __importDefault(require("../downloadRequest"));
var fs_extra_1 = __importDefault(require("fs-extra"));
var inquirer_1 = __importDefault(require("inquirer"));
var chalk_1 = __importDefault(require("chalk"));
var lodash_1 = __importStar(require("lodash"));
var rimraf_1 = __importDefault(require("rimraf"));
var installDependency_1 = __importDefault(require("../installDependency"));
var libs_1 = require("../../libs");
var credential_1 = require("../credential");
var utils_1 = require("./utils");
var parse_1 = __importDefault(require("./parse"));
var gray = chalk_1.default.hex('#8c8d91');
var artTemplate = require('art-template');
function tryfun(f) {
    return __awaiter(this, void 0, void 0, function () {
        var error_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    _a.trys.push([0, 2, , 3]);
                    return [4 /*yield*/, f];
                case 1: return [2 /*return*/, _a.sent()];
                case 2:
                    error_1 = _a.sent();
                    return [3 /*break*/, 3];
                case 3: return [2 /*return*/];
            }
        });
    });
}
function preInit(_a) {
    var temporaryPath = _a.temporaryPath, applicationPath = _a.applicationPath;
    return __awaiter(this, void 0, void 0, function () {
        var baseChildComponent, tempObj, e_1;
        return __generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    _b.trys.push([0, 3, , 4]);
                    return [4 /*yield*/, require(path_1.default.join(temporaryPath, 'hook'))];
                case 1:
                    baseChildComponent = _b.sent();
                    tempObj = {
                        tempPath: temporaryPath,
                        targetPath: applicationPath,
                        downloadRequest: downloadRequest_1.default,
                        fse: fs_extra_1.default,
                        lodash: lodash_1.default,
                    };
                    return [4 /*yield*/, baseChildComponent.preInit(tempObj)];
                case 2:
                    _b.sent();
                    return [3 /*break*/, 4];
                case 3:
                    e_1 = _b.sent();
                    return [3 /*break*/, 4];
                case 4: return [2 /*return*/];
            }
        });
    });
}
function postInit(_a) {
    var temporaryPath = _a.temporaryPath, applicationPath = _a.applicationPath;
    return __awaiter(this, void 0, void 0, function () {
        var baseChildComponent, tempObj, e_2;
        return __generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    _b.trys.push([0, 3, , 4]);
                    return [4 /*yield*/, require(path_1.default.join(temporaryPath, 'hook'))];
                case 1:
                    baseChildComponent = _b.sent();
                    tempObj = {
                        tempPath: temporaryPath,
                        targetPath: applicationPath,
                        downloadRequest: downloadRequest_1.default,
                        fse: fs_extra_1.default,
                        lodash: lodash_1.default,
                    };
                    return [4 /*yield*/, baseChildComponent.postInit(tempObj)];
                case 2:
                    _b.sent();
                    return [3 /*break*/, 4];
                case 3:
                    e_2 = _b.sent();
                    return [3 /*break*/, 4];
                case 4: return [2 /*return*/];
            }
        });
    });
}
var LoadApplication = /** @class */ (function () {
    function LoadApplication(config) {
        this.config = config;
    }
    LoadApplication.prototype.byUrl = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, source, registry, target, applicationPath;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = this.config, source = _a.source, registry = _a.registry, target = _a.target;
                        applicationPath = path_1.default.resolve(target, source);
                        return [4 /*yield*/, downloadRequest_1.default(registry, applicationPath, {
                                extract: true,
                            })];
                    case 1:
                        _b.sent();
                        return [2 /*return*/, applicationPath];
                }
            });
        });
    };
    LoadApplication.prototype.loadType = function () {
        return __awaiter(this, void 0, void 0, function () {
            var registry;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        registry = this.config.registry;
                        if (!(registry === constant_1.RegistryEnum.serverless || registry === constant_1.RegistryEnum.serverlessOld)) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.loadServerless()];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2:
                        if (!(registry === constant_1.RegistryEnum.github)) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.loadGithub()];
                    case 3: return [2 /*return*/, _a.sent()];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LoadApplication.prototype.loadServerless = function () {
        return __awaiter(this, void 0, void 0, function () {
            var source, _a, provider, componentName, _b, name, version, zipball_url, result, findObj, result, newName, applicationPath;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        source = this.config.source.includes('/')
                            ? this.config.source
                            : "./" + this.config.source;
                        _a = source.split('/'), provider = _a[0], componentName = _a[1];
                        if (!componentName)
                            return [2 /*return*/];
                        _b = componentName.split('@'), name = _b[0], version = _b[1];
                        if (!version) return [3 /*break*/, 2];
                        return [4 /*yield*/, tryfun(service_1.getServerlessReleases(provider, name))];
                    case 1:
                        result = _c.sent();
                        if (!result)
                            return [2 /*return*/];
                        findObj = result.find(function (item) { return item.tag_name === version; });
                        if (!findObj)
                            return [2 /*return*/];
                        zipball_url = findObj.zipball_url;
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, tryfun(service_1.getServerlessReleasesLatest(provider, name))];
                    case 3:
                        result = _c.sent();
                        if (!lodash_1.get(result, 'zipball_url'))
                            return [2 /*return*/];
                        zipball_url = result.zipball_url;
                        _c.label = 4;
                    case 4:
                        newName = this.config.name || name;
                        applicationPath = path_1.default.resolve(this.config.target, newName);
                        return [2 /*return*/, this.handleDecompressFile({
                                zipball_url: zipball_url,
                                applicationPath: applicationPath,
                                name: newName,
                            })];
                }
            });
        });
    };
    LoadApplication.prototype.loadGithub = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, user, componentName, _b, name, version, zipball_url, result, findObj, result, newName, applicationPath;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        if (!this.config.source.includes('/'))
                            return [2 /*return*/];
                        _a = this.config.source.split('/'), user = _a[0], componentName = _a[1];
                        _b = componentName.split('@'), name = _b[0], version = _b[1];
                        if (!version) return [3 /*break*/, 2];
                        return [4 /*yield*/, tryfun(service_1.getGithubReleases(user, name))];
                    case 1:
                        result = _c.sent();
                        if (!result)
                            return [2 /*return*/];
                        findObj = result.find(function (item) { return item.tag_name === version; });
                        if (!findObj)
                            return [2 /*return*/];
                        zipball_url = findObj.zipball_url;
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, tryfun(service_1.getGithubReleasesLatest(user, name))];
                    case 3:
                        result = _c.sent();
                        if (!lodash_1.get(result, 'zipball_url'))
                            return [2 /*return*/];
                        zipball_url = result.zipball_url;
                        _c.label = 4;
                    case 4:
                        newName = this.config.name || name;
                        applicationPath = path_1.default.join(this.config.target, newName);
                        return [2 /*return*/, this.handleDecompressFile({
                                zipball_url: zipball_url,
                                applicationPath: applicationPath,
                                name: newName,
                            })];
                }
            });
        });
    };
    LoadApplication.prototype.handleDecompressFile = function (_a) {
        var zipball_url = _a.zipball_url, applicationPath = _a.applicationPath, name = _a.name;
        return __awaiter(this, void 0, void 0, function () {
            var answer, temporaryPath, publishYamlData, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0: return [4 /*yield*/, this.checkFileExists(applicationPath, name)];
                    case 1:
                        answer = _c.sent();
                        if (!answer)
                            return [2 /*return*/, applicationPath];
                        temporaryPath = "" + applicationPath + new Date().getTime();
                        return [4 /*yield*/, downloadRequest_1.default(zipball_url, temporaryPath, {
                                extract: true,
                                strip: 1,
                            })];
                    case 2:
                        _c.sent();
                        return [4 /*yield*/, preInit({ temporaryPath: temporaryPath, applicationPath: applicationPath })];
                    case 3:
                        _c.sent();
                        return [4 /*yield*/, libs_1.getYamlContent(path_1.default.join(temporaryPath, 'publish.yaml'))];
                    case 4:
                        publishYamlData = _c.sent();
                        if (!publishYamlData) return [3 /*break*/, 10];
                        fs_extra_1.default.copySync(temporaryPath + "/src", applicationPath);
                        rimraf_1.default.sync(temporaryPath);
                        if (!this.config.parameters) return [3 /*break*/, 6];
                        return [4 /*yield*/, this.initSconfigWithParam({ publishYamlData: publishYamlData, applicationPath: applicationPath })];
                    case 5:
                        _b = _c.sent();
                        return [3 /*break*/, 8];
                    case 6: return [4 /*yield*/, this.initSconfig({ publishYamlData: publishYamlData, applicationPath: applicationPath })];
                    case 7:
                        _b = _c.sent();
                        _c.label = 8;
                    case 8:
                        _b;
                        return [4 /*yield*/, this.initEnvConfig(applicationPath)];
                    case 9:
                        _c.sent();
                        return [3 /*break*/, 11];
                    case 10:
                        fs_extra_1.default.moveSync("" + temporaryPath, applicationPath);
                        _c.label = 11;
                    case 11: return [4 /*yield*/, this.needInstallDependency(applicationPath)];
                    case 12:
                        _c.sent();
                        return [4 /*yield*/, postInit({ temporaryPath: temporaryPath, applicationPath: applicationPath })];
                    case 13:
                        _c.sent();
                        return [2 /*return*/, applicationPath];
                }
            });
        });
    };
    LoadApplication.prototype.needInstallDependency = function (cwd) {
        return __awaiter(this, void 0, void 0, function () {
            var packageInfo, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        packageInfo = libs_1.readJsonFile(path_1.default.resolve(cwd, 'package.json'));
                        if (!packageInfo || !lodash_1.get(packageInfo, 'autoInstall', true))
                            return [2 /*return*/];
                        if (!process.env.skipPrompt) return [3 /*break*/, 2];
                        return [4 /*yield*/, tryfun(installDependency_1.default({ cwd: cwd, production: false }))];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2:
                        if (this.config.parameters)
                            return [2 /*return*/, true];
                        return [4 /*yield*/, inquirer_1.default.prompt([
                                {
                                    type: 'confirm',
                                    name: 'confirm',
                                    message: 'Do you want to install dependencies?',
                                    default: true,
                                },
                            ])];
                    case 3:
                        res = _a.sent();
                        if (!res.confirm) return [3 /*break*/, 5];
                        return [4 /*yield*/, tryfun(installDependency_1.default({ cwd: cwd, production: false }))];
                    case 4:
                        _a.sent();
                        _a.label = 5;
                    case 5: return [2 /*return*/];
                }
            });
        });
    };
    LoadApplication.prototype.initEnvConfig = function (appPath) {
        return __awaiter(this, void 0, void 0, function () {
            var envExampleFilePath, envConfig, templateKeys, promptOption, result, newEnvConfig;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        envExampleFilePath = path_1.default.resolve(appPath, '.env.example');
                        if (!fs_extra_1.default.existsSync(envExampleFilePath))
                            return [2 /*return*/];
                        envConfig = fs_extra_1.default.readFileSync(envExampleFilePath, 'utf-8');
                        templateKeys = utils_1.getTemplatekey(envConfig);
                        if (templateKeys.length === 0)
                            return [2 /*return*/];
                        promptOption = templateKeys.map(function (item) {
                            var name = item.name, desc = item.desc;
                            return {
                                type: 'input',
                                message: "please input " + (desc || name) + ":",
                                name: name,
                            };
                        });
                        return [4 /*yield*/, inquirer_1.default.prompt(promptOption)];
                    case 1:
                        result = _a.sent();
                        newEnvConfig = utils_1.replaceFun(envConfig, result);
                        fs_extra_1.default.unlink(envExampleFilePath);
                        fs_extra_1.default.writeFileSync(path_1.default.resolve(appPath, '.env'), newEnvConfig, 'utf-8');
                        return [2 /*return*/];
                }
            });
        });
    };
    LoadApplication.prototype.initSconfig = function (_a) {
        var publishYamlData = _a.publishYamlData, applicationPath = _a.applicationPath;
        return __awaiter(this, void 0, void 0, function () {
            var properties, requiredList, promptList, rangeList, key, ele, _loop_1, _i, rangeList_1, item, spath, credentialAliasList, _b, result, data, newData;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        properties = lodash_1.get(publishYamlData, 'Parameters.properties');
                        requiredList = lodash_1.get(publishYamlData, 'Parameters.required');
                        promptList = [];
                        if (properties) {
                            rangeList = [];
                            for (key in properties) {
                                ele = properties[key];
                                ele['_key'] = key;
                                rangeList.push(ele);
                            }
                            rangeList = lodash_1.sortBy(rangeList, function (o) { return o['x-range']; });
                            _loop_1 = function (item) {
                                var name_1 = item._key;
                                // 布尔类型
                                if (item.type === 'boolean') {
                                    promptList.push({
                                        type: 'confirm',
                                        name: name_1,
                                        message: item.description,
                                        default: item.default,
                                    });
                                }
                                else if (item.type === 'password') {
                                    // 密码类型
                                    promptList.push({
                                        type: 'password',
                                        name: name_1,
                                        message: item.description,
                                        default: item.default,
                                    });
                                }
                                else if (item.enum) {
                                    // 枚举类型
                                    promptList.push({
                                        type: 'list',
                                        name: name_1,
                                        prefix: item.description ? gray(item.description) + "\n" + chalk_1.default.green('?') : undefined,
                                        message: item.title,
                                        choices: item.enum,
                                        default: item.default,
                                    });
                                }
                                else if (item.type === 'string') {
                                    // 字符串类型
                                    promptList.push({
                                        type: 'input',
                                        message: item.title,
                                        name: name_1,
                                        prefix: item.description ? gray(item.description) + "\n" + chalk_1.default.green('?') : undefined,
                                        default: item.default,
                                        validate: function (input) {
                                            if (lodash_1.includes(requiredList, name_1)) {
                                                return input.length > 0 ? true : 'value cannot be empty.';
                                            }
                                            return true;
                                        },
                                    });
                                }
                            };
                            for (_i = 0, rangeList_1 = rangeList; _i < rangeList_1.length; _i++) {
                                item = rangeList_1[_i];
                                _loop_1(item);
                            }
                        }
                        spath = utils_1.getYamlPath(applicationPath, 's');
                        if (lodash_1.isEmpty(spath))
                            return [2 /*return*/];
                        _b = lodash_1.map;
                        return [4 /*yield*/, credential_1.getCredentialAliasList()];
                    case 1:
                        credentialAliasList = _b.apply(void 0, [_c.sent(), function (o) { return ({
                                name: o,
                                value: o,
                            }); }]);
                        result = {};
                        if (!lodash_1.isEmpty(credentialAliasList)) return [3 /*break*/, 5];
                        promptList.push({
                            type: 'confirm',
                            name: 'access',
                            message: 'create credential?',
                            default: true,
                        });
                        return [4 /*yield*/, inquirer_1.default.prompt(promptList)];
                    case 2:
                        result = _c.sent();
                        if (!(result === null || result === void 0 ? void 0 : result.access)) return [3 /*break*/, 4];
                        return [4 /*yield*/, credential_1.setCredential()];
                    case 3:
                        data = _c.sent();
                        result.access = data === null || data === void 0 ? void 0 : data.Alias;
                        _c.label = 4;
                    case 4: return [3 /*break*/, 7];
                    case 5:
                        promptList.push({
                            type: 'list',
                            name: 'access',
                            message: 'please select credential alias',
                            choices: lodash_1.concat(credentialAliasList, {
                                name: 'configure later.',
                                value: false,
                            }),
                        });
                        return [4 /*yield*/, inquirer_1.default.prompt(promptList)];
                    case 6:
                        result = _c.sent();
                        _c.label = 7;
                    case 7:
                        if ((result === null || result === void 0 ? void 0 : result.access) === false) {
                            result.access = '{{ access }}';
                        }
                        artTemplate.defaults.extname = path_1.default.extname(spath);
                        newData = artTemplate(spath, result);
                        // art 语法需要先解析在验证yaml内容
                        fs_extra_1.default.writeFileSync(spath, newData, 'utf-8');
                        // fix: Document with errors cannot be stringified
                        return [4 /*yield*/, libs_1.isYamlFile(spath)];
                    case 8:
                        // fix: Document with errors cannot be stringified
                        _c.sent();
                        newData = parse_1.default({ appName: this.config.appName }, newData);
                        fs_extra_1.default.writeFileSync(spath, newData, 'utf-8');
                        return [2 /*return*/];
                }
            });
        });
    };
    LoadApplication.prototype.initSconfigWithParam = function (_a) {
        var publishYamlData = _a.publishYamlData, applicationPath = _a.applicationPath;
        return __awaiter(this, void 0, void 0, function () {
            var spath, result, properties, requiredList, newObj, key, ele, accessObj, newData;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        spath = utils_1.getYamlPath(applicationPath, 's');
                        if (lodash_1.isEmpty(spath))
                            return [2 /*return*/];
                        result = this.config.parameters;
                        properties = lodash_1.get(publishYamlData, 'Parameters.properties');
                        requiredList = lodash_1.get(publishYamlData, 'Parameters.required', []);
                        newObj = {};
                        if (properties) {
                            for (key in properties) {
                                ele = properties[key];
                                if (result.hasOwnProperty(key)) {
                                    newObj[key] = result[key];
                                }
                                else if (ele.hasOwnProperty('default')) {
                                    newObj[key] = ele.default;
                                }
                                else if (lodash_1.includes(requiredList, key)) {
                                    throw new Error(key + " parameter is required.");
                                }
                            }
                        }
                        accessObj = this.config.access ? { access: this.config.access } : {};
                        artTemplate.defaults.extname = path_1.default.extname(spath);
                        newData = artTemplate(spath, __assign(__assign({}, newObj), accessObj));
                        fs_extra_1.default.writeFileSync(spath, newData, 'utf-8');
                        return [4 /*yield*/, libs_1.isYamlFile(spath)];
                    case 1:
                        _b.sent();
                        newData = parse_1.default({ appName: this.config.appName }, newData);
                        fs_extra_1.default.writeFileSync(spath, newData, 'utf-8');
                        return [2 /*return*/];
                }
            });
        });
    };
    LoadApplication.prototype.checkFileExists = function (filePath, fileName) {
        return __awaiter(this, void 0, void 0, function () {
            var res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (process.env.skipPrompt)
                            return [2 /*return*/, true];
                        if (this.config.parameters)
                            return [2 /*return*/, true];
                        if (!fs_extra_1.default.existsSync(filePath)) return [3 /*break*/, 2];
                        return [4 /*yield*/, inquirer_1.default.prompt([
                                {
                                    type: 'confirm',
                                    name: 'confirm',
                                    message: "File " + fileName + " already exists, override this file ?",
                                    default: true,
                                },
                            ])];
                    case 1:
                        res = _a.sent();
                        return [2 /*return*/, res.confirm];
                    case 2: 
                    // 不存在文件，返回true表示需要覆盖
                    return [2 /*return*/, true];
                }
            });
        });
    };
    return LoadApplication;
}());
function loadApplication(oldsource, oldregistry, oldtarget) {
    return __awaiter(this, void 0, void 0, function () {
        var config, instance, appPath, registryFromSetConfig;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    config = {};
                    if (typeof oldsource === 'string') {
                        config.source = oldsource;
                        config.registry = oldregistry;
                        config.target = oldtarget || libs_1.S_CURRENT;
                    }
                    else {
                        config.source = oldsource.source;
                        config.registry = oldsource.registry;
                        config.target = oldsource.target || libs_1.S_CURRENT;
                        config.name = oldsource.name;
                        config.parameters = oldsource.parameters;
                        config.appName = oldsource.appName;
                        config.access = oldsource.access;
                    }
                    instance = new LoadApplication(config);
                    if (!config.registry) return [3 /*break*/, 2];
                    if (!(config.registry !== constant_1.RegistryEnum.github && config.registry !== constant_1.RegistryEnum.serverless)) return [3 /*break*/, 2];
                    return [4 /*yield*/, instance.byUrl()];
                case 1: 
                // 支持 自定义
                return [2 /*return*/, _a.sent()];
                case 2:
                    if (!config.registry) return [3 /*break*/, 4];
                    return [4 /*yield*/, instance.loadType()];
                case 3:
                    appPath = _a.sent();
                    if (appPath)
                        return [2 /*return*/, appPath];
                    _a.label = 4;
                case 4: return [4 /*yield*/, libs_1.getSetConfig('registry')];
                case 5:
                    registryFromSetConfig = _a.sent();
                    if (!registryFromSetConfig) return [3 /*break*/, 7];
                    return [4 /*yield*/, instance.loadType()];
                case 6:
                    appPath = _a.sent();
                    if (appPath)
                        return [2 /*return*/, appPath];
                    _a.label = 7;
                case 7: return [4 /*yield*/, instance.loadServerless()];
                case 8:
                    appPath = _a.sent();
                    if (appPath)
                        return [2 /*return*/, appPath];
                    return [4 /*yield*/, instance.loadGithub()];
                case 9:
                    appPath = _a.sent();
                    if (appPath)
                        return [2 /*return*/, appPath];
                    if (!appPath) {
                        throw new Error(JSON.stringify({
                            message: "No " + config.source + " app found.",
                            tips: 'Please make sure the app name or source is correct, you can get applications on Serverless Regsitry: https://registry.serverless-devs.com',
                        }));
                    }
                    return [2 /*return*/];
            }
        });
    });
}
exports.default = loadApplication;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZEFwcGxpY2F0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbW1vbi9sb2FkL2xvYWRBcHBsaWNhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHFDQUttQjtBQUNuQix3Q0FBMkM7QUFDM0MsOENBQXdCO0FBQ3hCLHVFQUFpRDtBQUNqRCxzREFBMEI7QUFDMUIsc0RBQWdDO0FBQ2hDLGdEQUEwQjtBQUMxQiwrQ0FBd0U7QUFDeEUsa0RBQTRCO0FBQzVCLDJFQUFxRDtBQUNyRCxtQ0FBK0Y7QUFDL0YsNENBQXNFO0FBQ3RFLGlDQUFrRTtBQUNsRSxrREFBNEI7QUFDNUIsSUFBTSxJQUFJLEdBQUcsZUFBSyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNsQyxJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7QUFZMUMsU0FBZSxNQUFNLENBQUMsQ0FBZTs7Ozs7OztvQkFFMUIscUJBQU0sQ0FBQyxFQUFBO3dCQUFkLHNCQUFPLFNBQU8sRUFBQzs7Ozs7Ozs7Q0FJbEI7QUFFRCxTQUFlLE9BQU8sQ0FBQyxFQUFrQztRQUFoQyxhQUFhLG1CQUFBLEVBQUUsZUFBZSxxQkFBQTs7Ozs7OztvQkFFeEIscUJBQU0sT0FBTyxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUE7O29CQUFwRSxrQkFBa0IsR0FBRyxTQUErQztvQkFDcEUsT0FBTyxHQUFHO3dCQUNkLFFBQVEsRUFBRSxhQUFhO3dCQUN2QixVQUFVLEVBQUUsZUFBZTt3QkFDM0IsZUFBZSxFQUFFLHlCQUFlO3dCQUNoQyxHQUFHLEVBQUUsa0JBQUU7d0JBQ1AsTUFBTSxFQUFFLGdCQUFDO3FCQUNWLENBQUM7b0JBQ0YscUJBQU0sa0JB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