"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// https://www.npmjs.com/package/ignore-walk
var fs = __importStar(require("fs"));
var path_1 = __importDefault(require("path"));
var events_1 = require("events");
var minimatch_1 = require("minimatch");
var Walker = /** @class */ (function (_super) {
    __extends(Walker, _super);
    function Walker(opts) {
        var _this = this;
        opts = opts || {};
        _this = _super.call(this, opts) || this;
        // set to true if this.path is a symlink, whether follow is true or not
        _this.isSymbolicLink = opts.isSymbolicLink;
        _this.path = opts.path || process.cwd();
        _this.basename = path_1.default.basename(_this.path);
        _this.ignoreFiles = opts.ignoreFiles || ['.signore'];
        _this.ignoreRules = {};
        _this.parent = opts.parent || null;
        _this.includeEmpty = !!opts.includeEmpty;
        _this.root = _this.parent ? _this.parent.root : _this.path;
        _this.follow = !!opts.follow;
        _this.result = _this.parent ? _this.parent.result : new Set();
        _this.entries = null;
        _this.sawError = false;
        return _this;
    }
    Walker.prototype.sort = function (a, b) {
        return a.localeCompare(b, 'en');
    };
    Walker.prototype.emit = function (ev, data) {
        var ret = false;
        if (!(this.sawError && ev === 'error')) {
            if (ev === 'error') {
                this.sawError = true;
            }
            else if (ev === 'done' && !this.parent) {
                data = Array.from(data)
                    .map(function (e) { return /^@/.test(e) ? "./" + e : e; }).sort(this.sort);
                this.result = data;
            }
            if (ev === 'error' && this.parent) {
                ret = this.parent.emit('error', data);
            }
            else {
                ret = _super.prototype.emit.call(this, ev, data);
            }
        }
        return ret;
    };
    Walker.prototype.start = function () {
        var _this = this;
        fs.readdir(this.path, function (er, entries) {
            return er ? _this.emit('error', er) : _this.onReaddir(entries);
        });
        return this;
    };
    Walker.prototype.isIgnoreFile = function (e) {
        return e !== '.' &&
            e !== '..' &&
            this.ignoreFiles.indexOf(e) !== -1;
    };
    Walker.prototype.onReaddir = function (entries) {
        var _this = this;
        this.entries = entries;
        if (entries.length === 0) {
            if (this.includeEmpty) {
                this.result.add(this.path.substr(this.root.length + 1));
            }
            this.emit('done', this.result);
        }
        else {
            var hasIg = this.entries.some(function (e) { return _this.isIgnoreFile(e); });
            if (hasIg) {
                this.addIgnoreFiles();
            }
            else {
                this.filterEntries();
            }
        }
    };
    Walker.prototype.addIgnoreFiles = function () {
        var _this = this;
        var newIg = this.entries
            .filter(function (e) { return _this.isIgnoreFile(e); });
        var igCount = newIg.length;
        var then = function (_) {
            if (--igCount === 0) {
                _this.filterEntries();
            }
        };
        newIg.forEach(function (e) { return _this.addIgnoreFile(e, then); });
    };
    Walker.prototype.addIgnoreFile = function (file, then) {
        var _this = this;
        var ig = path_1.default.resolve(this.path, file);
        fs.readFile(ig, 'utf8', function (er, data) {
            return er ? _this.emit('error', er) : _this.onReadIgnoreFile(file, data, then);
        });
    };
    Walker.prototype.onReadIgnoreFile = function (file, data, then) {
        var mmopt = {
            matchBase: true,
            dot: true,
            flipNegate: true,
            nocase: true,
        };
        var rules = data.split(/\r?\n/)
            .filter(function (line) { return !/^#|^$/.test(line.trim()); })
            .map(function (r) {
            // support ./ && !./
            if (r) {
                if (r.startsWith('./')) {
                    r = r.substring(1);
                }
                else if (r.startsWith('!./')) {
                    r = r.replace(/^(\!\.\/)/, '!/');
                }
            }
            return new minimatch_1.Minimatch(r, mmopt);
        });
        this.ignoreRules[file] = rules;
        then();
    };
    Walker.prototype.filterEntries = function () {
        var _this = this;
        // at this point we either have ignore rules, or just inheriting
        // this exclusion is at the point where we know the list of
        // entries in the dir, but don't know what they are.  since
        // some of them *might* be directories, we have to run the
        // match in dir-mode as well, so that we'll pick up partials
        // of files that will be included later.  Anything included
        // at this point will be checked again later once we know
        // what it is.
        var filtered = this.entries.map(function (entry) {
            // at this point, we don't know if it's a dir or not.
            var passFile = _this.filterEntry(entry, false);
            var passDir = _this.filterEntry(entry, true);
            return (passFile || passDir) ? [entry, passFile, passDir] : false;
        }).filter(function (e) { return e; });
        // now we stat them all
        // if it's a dir, and passes as a dir, then recurse
        // if it's not a dir, but passes as a file, add to set
        var entryCount = filtered.length;
        if (entryCount === 0) {
            this.emit('done', this.result);
        }
        else {
            var then_1 = function (_) {
                if (--entryCount === 0) {
                    _this.emit('done', _this.result);
                }
            };
            filtered.forEach(function (filt) {
                var entry = filt[0];
                var file = filt[1];
                var dir = filt[2];
                _this.stat({ entry: entry, file: file, dir: dir }, then_1);
            });
        }
    };
    Walker.prototype.onstat = function (_a, then) {
        var st = _a.st, entry = _a.entry, file = _a.file, dir = _a.dir, isSymbolicLink = _a.isSymbolicLink;
        var abs = this.path + '/' + entry;
        if (!st.isDirectory()) {
            if (file) {
                this.result.add(abs.substring(this.root.length + 1));
            }
            then();
        }
        else {
            // is a directory
            if (dir) {
                this.walker(entry, { isSymbolicLink: isSymbolicLink }, then);
            }
            else {
                then();
            }
        }
    };
    Walker.prototype.stat = function (_a, then) {
        var _this = this;
        var entry = _a.entry, file = _a.file, dir = _a.dir;
        var abs = this.path + '/' + entry;
        fs.lstat(abs, function (er, st) {
            if (er) {
                _this.emit('error', er);
            }
            else {
                var isSymbolicLink_1 = st.isSymbolicLink();
                if (_this.follow && isSymbolicLink_1) {
                    fs.stat(abs, function (er, st) {
                        if (er) {
                            _this.emit('error', er);
                        }
                        else {
                            _this.onstat({ st: st, entry: entry, file: file, dir: dir, isSymbolicLink: isSymbolicLink_1 }, then);
                        }
                    });
                }
                else {
                    _this.onstat({ st: st, entry: entry, file: file, dir: dir, isSymbolicLink: isSymbolicLink_1 }, then);
                }
            }
        });
    };
    Walker.prototype.walkerOpt = function (entry, opts) {
        return __assign({ path: this.path + '/' + entry, parent: this, ignoreFiles: this.ignoreFiles, follow: this.follow, includeEmpty: this.includeEmpty }, opts);
    };
    Walker.prototype.walker = function (entry, opts, then) {
        new Walker(this.walkerOpt(entry, opts)).on('done', then).start();
    };
    Walker.prototype.filterEntry = function (entry, partial) {
        var _this = this;
        var included = true;
        // this = /a/b/c
        // entry = d
        // parent /a/b sees c/d
        if (this.parent && this.parent.filterEntry) {
            var pt = this.basename + '/' + entry;
            included = this.parent.filterEntry(pt, partial);
        }
        this.ignoreFiles.forEach(function (f) {
            if (_this.ignoreRules[f]) {
                _this.ignoreRules[f].forEach(function (rule) {
                    // negation means inclusion
                    // so if it's negated, and already included, no need to check
                    // likewise if it's neither negated nor included
                    if (rule.negate !== included) {
                        // first, match against /foo/bar
                        // then, against foo/bar
                        // then, in the case of partials, match with a /
                        var match = rule.match('/' + entry) ||
                            rule.match(entry) ||
                            (!!partial && (rule.match('/' + entry + '/') ||
                                rule.match(entry + '/'))) ||
                            (!!partial && rule.negate && (rule.match('/' + entry, true) ||
                                rule.match(entry, true)));
                        if (match) {
                            included = rule.negate;
                        }
                    }
                });
            }
        });
        return included;
    };
    return Walker;
}(events_1.EventEmitter));
var WalkerSync = /** @class */ (function (_super) {
    __extends(WalkerSync, _super);
    function WalkerSync() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WalkerSync.prototype.start = function () {
        this.onReaddir(fs.readdirSync(this.path));
        return this;
    };
    WalkerSync.prototype.addIgnoreFile = function (file, then) {
        var ig = path_1.default.resolve(this.path, file);
        this.onReadIgnoreFile(file, fs.readFileSync(ig, 'utf8'), then);
    };
    WalkerSync.prototype.stat = function (_a, then) {
        var entry = _a.entry, file = _a.file, dir = _a.dir;
        var abs = this.path + '/' + entry;
        var st = fs.lstatSync(abs);
        var isSymbolicLink = st.isSymbolicLink();
        if (this.follow && isSymbolicLink) {
            st = fs.statSync(abs);
        }
        // console.error('STAT SYNC', {st, entry, file, dir, isSymbolicLink, then})
        this.onstat({ st: st, entry: entry, file: file, dir: dir, isSymbolicLink: isSymbolicLink }, then);
    };
    WalkerSync.prototype.walker = function (entry, opts, then) {
        new WalkerSync(this.walkerOpt(entry, opts)).start();
        then();
    };
    return WalkerSync;
}(Walker));
var walk = function (opts, callback) {
    var p = new Promise(function (resolve, reject) {
        new Walker(opts).on('done', resolve).on('error', reject).start();
    });
    return callback ? p.then(function (res) { return callback(null, res); }, callback) : p;
};
var walkSync = function (opts) { return new WalkerSync(opts).start().result; };
walk.sync = walkSync;
walk.Walker = Walker;
walk.WalkerSync = WalkerSync;
exports.default = walk;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWdub3JlV2Fsay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vaWdub3JlV2Fsay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0Q0FBNEM7QUFDNUMscUNBQXlCO0FBQ3pCLDhDQUF3QjtBQUN4QixpQ0FBNEM7QUFDNUMsdUNBQXNDO0FBRXRDO0lBQXFCLDBCQUFFO0lBY3JCLGdCQUFhLElBQUk7UUFBakIsaUJBZ0JDO1FBZkMsSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDbEIsUUFBQSxrQkFBTSxJQUFJLENBQUMsU0FBQztRQUNaLHVFQUF1RTtRQUN2RSxLQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDMUMsS0FBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUN2QyxLQUFJLENBQUMsUUFBUSxHQUFHLGNBQUksQ0FBQyxRQUFRLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLEtBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BELEtBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLEtBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUM7UUFDbEMsS0FBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUN4QyxLQUFJLENBQUMsSUFBSSxHQUFHLEtBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3ZELEtBQUksQ0FBQyxNQUFNLEdB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