"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var fs = __importStar(require("fs-extra"));
var lodash_1 = require("lodash");
var utils_1 = require("./utils");
var path_1 = __importDefault(require("path"));
var js_yaml_1 = __importDefault(require("js-yaml"));
var constant_1 = require("../constant");
var SPECIALL_VARIABLE_TYPE_REG = new RegExp(/(.*)\((.*)\)/, 'i');
var OTHER_BASIC_DATA_TYPE = ['[object Number]', '[object Boolean]'];
var Parse = /** @class */ (function () {
    function Parse(spath) {
        this.spath = spath;
        this.parsedObj = {};
        this.dependenciesMap = {};
        this.globalJsonKeyMap = {};
        if (fs.existsSync(spath)) {
            try {
                this.parsedObj = this.getFileObj(spath);
            }
            catch (error) {
                throw error;
            }
        }
    }
    Parse.prototype.getFileObj = function (filePath) {
        var fileObj = {};
        try {
            var extname = path_1.default.extname(filePath);
            if (extname.indexOf('.yaml') !== -1 || extname.indexOf('.yml') !== -1) {
                fileObj = js_yaml_1.default.load(fs.readFileSync(filePath, 'utf8'));
            }
            if (extname.indexOf('.json') !== -1) {
                fileObj = fs.readJSONSync(filePath);
            }
        }
        catch (error) { }
        return fileObj;
    };
    Parse.prototype.findVariableValue = function (variableObj) {
        var variableName = variableObj.variableName, type = variableObj.type, funName = variableObj.funName, funVariable = variableObj.funVariable;
        var result = '';
        if (type === 'Literal') {
            return (this.globalJsonKeyMap[variableName] ||
                this.globalJsonKeyMap["services." + variableName] ||
                '${' + variableName + '}');
        }
        if (type === 'Fun' && (funName === 'Env' || funName === 'env')) {
            return process.env[funVariable];
        }
        if (type === 'Fun' && (funName === 'Path' || funName === 'path')) {
            return utils_1.getCurrentPath(funVariable, this.spath);
        }
        if (type === 'Fun' && (funName === 'File' || funName === 'file')) {
            return this.getFileObj(funVariable);
        }
        if (type === 'Fun' && funName === 'config') {
            return this.credentials ? this.credentials[funVariable] : '${' + variableName + '}';
        }
        return result;
    };
    Parse.prototype.generateMagicVariables = function (value, arr, parentStr) {
        var _this = this;
        if (arr === void 0) { arr = []; }
        if (parentStr === void 0) { parentStr = ''; }
        if (Object.prototype.toString.call(value) === '[object Object]') {
            if (parentStr !== '') {
                parentStr = parentStr + ".";
            }
            Object.keys(value).map(function (key) {
                var showKey = "" + parentStr + key;
                var objValue = value[key];
                arr.push(showKey);
                arr.concat(_this.generateMagicVariables(objValue, arr, "" + showKey));
                _this.globalJsonKeyMap[showKey] = objValue;
            });
        }
        else if (Object.prototype.toString.call(value) === '[object Array]') {
            value.forEach(function (_arrValue, i) {
                var showKey = parentStr + "[" + i + "]";
                arr.push(showKey);
                arr.concat(_this.generateMagicVariables(_arrValue, arr, "" + showKey));
                _this.globalJsonKeyMap[showKey] = _arrValue;
            });
        }
        else {
            arr = [];
        }
        return arr;
    };
    Parse.prototype.iteratorToSetValue = function (objValue, topKey, parentKey) {
        var _this = this;
        if (OTHER_BASIC_DATA_TYPE.includes(Object.prototype.toString.call(objValue))) {
            return objValue;
        }
        if (Object.prototype.toString.call(objValue) === '[object String]') {
            var regResult = objValue.match(constant_1.COMMON_VARIABLE_TYPE_REG);
            if (regResult) {
                var tmp = objValue;
                for (var _i = 0, regResult_1 = regResult; _i < regResult_1.length; _i++) {
                    var iterator = regResult_1[_i];
                    var matchResult = iterator.replace(constant_1.COMMON_VARIABLE_TYPE_REG, '$1'); // get match result like projectName.key.variable
                    var variableObj = {
                        variableName: matchResult,
                        type: 'Literal',
                        funName: null,
                        funVariable: '',
                    };
                    var funMatchResult = matchResult.match(SPECIALL_VARIABLE_TYPE_REG);
                    if (funMatchResult) {
                        variableObj.funName = funMatchResult[1];
                        variableObj.funVariable = funMatchResult[2];
                        variableObj.type = 'Fun';
                    }
                    else {
                        var topKeyDependenciesMap = this.dependenciesMap[topKey];
                        if (!topKeyDependenciesMap) {
                            topKeyDependenciesMap = {};
                        }
                        var dependProjName = matchResult.split('.')[0];
                        topKeyDependenciesMap[dependProjName] = 1; // Dependent priority
                        this.dependenciesMap[topKey] = topKeyDependenciesMap;
                    }
                    var realValue = lodash_1.startsWith(matchResult, 'env.')
                        ? lodash_1.get(process, matchResult)
                        : this.findVariableValue(variableObj);
                    if (realValue) {
                        tmp =
                            Object.prototype.toString.call(realValue) === '[object String]'
                                ? tmp.replace(iterator, realValue)
                                : realValue;
                    }
                }
                return tmp;
            }
            if (!this.dependenciesMap[topKey] || Object.keys(this.dependenciesMap[topKey]).length == 0) {
                this.dependenciesMap[topKey] = {};
            }
            return objValue;
        }
        if (Object.prototype.toString.call(objValue) === '[object Array]') {
            return objValue.map(function (item) {
                return _this.iteratorToSetValue(item, topKey);
            });
        }
        if (Object.prototype.toString.call(objValue) === '[object Object]') {
            Object.keys(objValue).forEach(function (key) {
                objValue[key] = _this.iteratorToSetValue(objValue[key], topKey, parentKey || key);
            });
            return objValue;
        }
    };
    Parse.prototype.replaceVariable = function (variable) {
        var _this = this;
        var _variable = variable.services;
        Object.keys(_variable).forEach(function (key) {
            var objValue = _variable[key];
            variable.services[key] = _this.iteratorToSetValue(objValue, key);
        });
        return variable;
    };
    Parse.prototype.setCredentials = function (val) {
        this.credentials = val;
    };
    Parse.prototype.clearGlobalKey = function (val) {
        var tmp = {};
        for (var key in this.globalJsonKeyMap) {
            if (!lodash_1.startsWith(key, val)) {
                tmp[key] = this.globalJsonKeyMap[key];
            }
        }
        this.globalJsonKeyMap = tmp;
        return this;
    };
    Parse.prototype.getGlobalMagic = function () {
        return this.globalJsonKeyMap;
    };
    Parse.prototype.beforeInit = function (value) {
        this.parsedObj = value;
        return this;
    };
    Parse.prototype.init = function (obj) {
        return __awaiter(this, void 0, void 0, function () {
            var val, realVariables;
            return __generator(this, function (_a) {
                val = obj ? lodash_1.merge({}, this.parsedObj, obj) : this.parsedObj;
                this.generateMagicVariables(val);
                realVariables = this.replaceVariable(val);
                return [2 /*return*/, { realVariables: realVariables, dependenciesMap: this.dependenciesMap }];
            });
        });
    };
    return Parse;
}());
exports.default = Parse;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tbW9uL2V4ZWNDb21tYW5kL3BhcnNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUErQjtBQUMvQixpQ0FBZ0Q7QUFDaEQsaUNBQXlDO0FBQ3pDLDhDQUF3QjtBQUN4QixvREFBMkI7QUFFM0Isd0NBQXVEO0FBRXZELElBQU0sMEJBQTBCLEdBQUcsSUFBSSxNQUFNLENBQUMsY0FBYyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBRW5FLElBQU0scUJBQXFCLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0FBRXRFO0lBTUUsZUFBc0IsS0FBYztRQUFkLFVBQUssR0FBTCxLQUFLLENBQVM7UUFMNUIsY0FBUyxHQUFRLEVBQUUsQ0FBQztRQUNwQixvQkFBZSxHQUEyQixFQUFFLENBQUM7UUFDN0MscUJBQWdCLEdBQVEsRUFBRSxDQUFDO1FBSWpDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN4QixJQUFJO2dCQUNGLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN6QztZQUFDLE9BQU8sS0FBSyxFQUFFO2dCQUNkLE1BQU0sS0FBSyxDQUFDO2FBQ2I7U0FDRjtJQUNILENBQUM7SUFFTywwQkFBVSxHQUFsQixVQUFtQixRQUFnQjtRQUNqQyxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDakIsSUFBSTtZQUNGLElBQU0sT0FBTyxHQUFHLGNBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdkMsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENB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